<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysiqueRUSH</title>
  <link rel="icon" type="image/png" href="icon-192.png" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0d0d0d" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Poppins", Arial, sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at center, #1a0000, #000);
      color: white;
      overflow: hidden;
    }

    /* === Gestion des √©crans === */
.screen {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: none;                 /* cach√© par d√©faut */
  flex-direction: column;
  align-items: center;
  padding-top: 5vh;
  padding-bottom: 90px;          /* r√©serve de place pour le bouton Retour */
}

    .screen.active {
      display: flex;                 /* on affiche seulement l‚Äô√©cran actif */
    }

    /* --- Logo & titre --- */
    .logo {
      width: 120px;
      height: 120px;
      border-radius: 20%;
      box-shadow: 0 0 25px #ff000044, 0 0 60px #ff000022 inset;
      animation: logoPulse 3s infinite alternate;
      margin-bottom: 1rem;
      z-index: 2;
    }

    @keyframes logoPulse {
      from { box-shadow: 0 0 25px #ff000033, 0 0 70px #ff000011 inset; }
      to   { box-shadow: 0 0 45px #ff000077, 0 0 120px #ff000033 inset; }
    }

    h1 {
      font-size: 2.8rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #ff2b2b;
      text-shadow: 0 0 30px #ff000099;
      margin-bottom: 2rem;
      animation: glowPulse 3s infinite alternate;
      z-index: 2;
    }

    @keyframes glowPulse {
      from { text-shadow: 0 0 10px #ff1a1a; }
      to   { text-shadow: 0 0 45px #ff0000; }
    }

    /* --- Menus g√©n√©raux --- */
    .menu {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 1.4rem;
      margin-top: 1rem;
      z-index: 2;
      width: 80%;
      max-width: 400px;
    }

    button {
      background: linear-gradient(145deg, #330000, #660000);
      border: 2px solid #ff2b2b;
      color: #fff;
      font-size: 1.15rem;
      font-weight: bold;
      padding: 1.2rem 0;
      width: 100%;
      border-radius: 20px;
      cursor: pointer;
      /* halo rouge mais plus l√©ger */
      box-shadow: 0 0 18px rgba(255,0,0,0.5);
      transition: transform 0.12s ease, box-shadow 0.12s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:hover {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 0 24px rgba(255,0,0,0.7);
    }

    /* --- Fond gazeux global (halo rouge statique) --- */
    .background-glow, .background-glow2 {
      position: absolute;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, #ff000033 0%, transparent 70%);
      filter: blur(100px);
      z-index: 0;
    }

    .background-glow {
      top: -100px;
      left: -100px;
    }

    .background-glow2 {
      bottom: -150px;
      right: -150px;
      width: 800px;
      height: 800px;
      background: radial-gradient(circle, #ff222244 0%, transparent 70%);
    }

    /* --- Footer --- */
    footer {
      position: absolute;
      bottom: 12px;
      font-size: 0.8rem;
      color: #666;
      z-index: 2;
    }

    footer span {
      color: #ff3333;
      font-weight: bold;
    }

    /* --- Bouton retour : haut gauche pour ne pas g√™ner sur mobile --- */
.back-btn {
  position: absolute;
  bottom: 60px;                  /* bas de l‚Äô√©cran */
  left: 16px;                    /* coin gauche */
  background: #660000aa;
  color: #fff;
  border: 1px solid #ff3333;
  border-radius: 10px;
  padding: 0.4rem 0.8rem;
  font-size: 0.9rem;
  cursor: pointer;
  box-shadow: 0 0 10px #ff000055;
  transition: all 0.2s ease;
  width: auto;
  z-index: 5;
}

.back-btn:hover {
  background: #990000;
  transform: scale(1.05);
}

button:disabled {
  opacity: 0.5;
  cursor: default;
  box-shadow: none;
}
    

    /* --- Textes secondaires --- */
    .subtitle {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #dddddd;
      text-align: center;
      max-width: 85%;
      z-index: 2;
    }

    .small-text {
      margin-top: 0.4rem;
      font-size: 0.8rem;
      color: #bbbbbb;
      text-align: center;
      max-width: 90%;
      z-index: 2;
    }

    /* --- La Test Room --- */
    .testroom-container {
      margin-top: 0.5rem;
      width: 90%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      z-index: 2;
    }

    .testroom-container .menu {
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .test-btn {
      font-size: 1rem;
      padding: 0.9rem 0;
      text-transform: none;
      letter-spacing: 0.5px;
    }

    .test-btn span {
      font-size: 0.8rem;
      font-weight: normal;
      text-transform: none;
    }

    .test-form {
      width: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      margin-top: 1rem;
    }

    .test-input {
      width: 100%;
      padding: 0.8rem;
      border-radius: 12px;
      border: 1px solid #ff5555;
      background: #1a0000;
      color: #ffffff;
      font-size: 1rem;
      text-align: center;
      outline: none;
    }

    .test-buttons-row {
      display: flex;
      gap: 0.8rem;
      width: 100%;
    }

    .test-buttons-row button {
      flex: 1;
      font-size: 1rem;
      padding: 0.8rem 0;
    }

    /* --- Mon √âvolution / Radar --- */
    .evolution-container {
      margin-top: 0.5rem;
      width: 90%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      z-index: 2;
    }

    #evolution-radar {
      background: radial-gradient(circle at center, #220000, #000000);
      border-radius: 50%;
      box-shadow: 0 0 20px #ff000040;
    }

    /* --- √âcran Puissance de Pouss√©e --- */
    .push-container {
      margin-top: 0.5rem;
      width: 90%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      z-index: 2;
    }

    .push-video-wrapper {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* ratio 16:9 */
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 18px rgba(255,0,0,0.6);
    }

    .push-video-wrapper iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      border: 0;
    }

    .push-start-btn {
      max-width: 260px;
      font-size: 1.2rem;
    }

    /* --- Overlay plein √©cran pour le test Push --- */
    .fullscreen-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.92);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
      text-align: center;
      padding: 1rem;
    }

    .fullscreen-overlay.active {
      display: flex;
    }

.big-countdown {
  font-size: 5.5rem;
  font-weight: bold;
  text-shadow: 0 0 30px #ff0000;
  margin-bottom: 1.2rem;
}


   .push-phase-text {
  font-size: 1.4rem;
  font-weight: bold;
  margin-bottom: 1rem;
  padding: 0.8rem 1rem;
  border-radius: 12px;
  background: rgba(255,0,0,0.18);
  border: 1px solid rgba(255,80,80,0.9);
  text-shadow: 0 0 8px rgba(0,0,0,0.7);
}


    .push-mini-video-wrapper {
      width: 70%;
      max-width: 260px;
      margin-bottom: 0.8rem;
    }

    .push-mini-video-wrapper iframe {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 12px;
      border: 0;
    }

.push-level-count {
  font-size: 2.6rem;
  font-weight: bold;
  margin-bottom: 1rem;
  text-shadow: 0 0 20px #ff0000;
}


    .push-actions {
      display: flex;
      gap: 1rem;
      width: 100%;
      max-width: 320px;
      justify-content: center;
    }

    .push-ok-btn,
    .push-fail-btn {
      flex: 1;
      font-size: 1.2rem;
      padding: 1rem 0;
    }

    .push-ok-btn {
      background: linear-gradient(145deg, #006633, #00aa55);
      border-color: #00ff99;
    }

    .push-fail-btn {
      background: linear-gradient(145deg, #660000, #aa0000);
      border-color: #ff5555;
    }
  </style>

   <!-- API Vimeo pour contr√¥ler pr√©cis√©ment le d√©marrage de la vid√©o -->
<script src="https://player.vimeo.com/api/player.js"></script>
</head>
 

<body>
  <!-- Fond gazeux -->
  <div class="background-glow"></div>
  <div class="background-glow2"></div>

  <!-- √âcran principal -->
  <section id="main-screen" class="screen active">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="menu">
      <button id="niveau">üí™ Mon Niveau</button>
      <button id="training">üî• Training Camp</button>
      <button id="improvise">‚ö° S√©ance Improvis√©e</button>
    </div>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "Mon Niveau" -->
  <section id="niveau-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="menu">
      <button id="testroom">üî± La Test Room</button>
      <button id="evolution">üß¨ Mon √âvolution</button>
      <button id="historique">üèÜ Historique des Perfs</button>
    </div>

    <button class="back-btn" id="back-niveau">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "La Test Room" -->
  <section id="testroom-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="testroom-container">
      <p class="subtitle">
        Choisis un test, entre ton score et valide. Seul le <b>dernier r√©sultat</b> est utilis√© pour le radar.
      </p>

      <!-- Menu des tests -->
      <div class="menu" id="testroom-menu">
        <button class="test-btn" data-test="push">
          üí• Puissance de Pouss√©e<br><span>Test guid√© de puissance</span>
        </button>
        <button class="test-btn" data-test="pull">
          üõ° Capacit√© de Tirage<br><span>Endurance des muscles du dos</span>
        </button>
        <button class="test-btn" data-test="legs">
          ü¶µ R√©sistance des Jambes<br><span>Force & endurance des jambes</span>
        </button>
        <button class="test-btn" data-test="cardio">
          ‚ù§Ô∏è Potentiel Cardio<br><span>Capacit√© a√©robie globale</span>
        </button>
        <button class="test-btn" data-test="definition">
          üß± Niveau de D√©finition Musculaire<br><span>%BF (plus bas = mieux)</span>
        </button>
      </div>

      <!-- Formulaire de saisie d'un test (hors Push guid√©) -->
      <div id="test-form" class="test-form">
        <h2 id="test-name">Test</h2>
        <input
          type="number"
          id="test-score"
          class="test-input"
          step="0.1"
          placeholder="Entre ton score"
        />
        <div class="test-buttons-row">
          <button id="save-test">‚úÖ Enregistrer</button>
          <button id="cancel-test">‚úñ Annuler</button>
        </div>
        <p class="small-text">
          Pour la <b>D√©finition</b>, saisis simplement ton <b>%BF actuel</b> (plus il est bas, mieux c'est).
        </p>
      </div>
    </div>

    <button class="back-btn" id="back-testroom">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "Puissance de Pouss√©e" -->
  <section id="push-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="push-container">
      <p class="subtitle">
        Test guid√© de <b>Puissance de Pouss√©e</b>. Regarde d'abord la vid√©o, puis lance le compte √† rebours.
      </p>

      <div class="push-video-wrapper">
        <iframe
          src="https://player.vimeo.com/video/717443574"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          title="Puissance de Pouss√©e - Explications"
        ></iframe>
      </div>

      <button id="push-start-btn" class="push-start-btn">üöÄ Commencer</button>
    </div>

    <!-- Overlay plein √©cran pour comptes √† rebours + paliers -->
    <div id="push-overlay" class="fullscreen-overlay">
      <div id="push-overlay-content"></div>
    </div>

    <button class="back-btn" id="back-push">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "Mon √âvolution" -->
  <section id="evolution-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="evolution-container">
      <p class="subtitle">
        Radar des 5 tests : Puissance de Pouss√©e, Capacit√© de Tirage, R√©sistance des Jambes,
        Potentiel Cardio, Niveau de D√©finition Musculaire (%BF). Chaque axe utilise ton <b>dernier</b> r√©sultat.
      </p>

      <canvas id="evolution-radar" width="320" height="320"></canvas>

      <p id="evo-legend" class="small-text">
        Va dans "La Test Room" pour enregistrer tes premiers tests.
      </p>
    </div>

    <button class="back-btn" id="back-evolution">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <script>
    /* ========= Navigation entre √©crans ========= */
    const screens = {
      main:      document.getElementById("main-screen"),
      niveau:    document.getElementById("niveau-screen"),
      testroom:  document.getElementById("testroom-screen"),
      push:      document.getElementById("push-screen"),
      evolution: document.getElementById("evolution-screen"),
    };

    function setActiveScreen(name) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      if (screens[name]) {
        screens[name].classList.add("active");
      }
    }

    // Boutons principaux
    const niveauBtn        = document.getElementById("niveau");
    const backNiveauBtn    = document.getElementById("back-niveau");
    const testroomBtn      = document.getElementById("testroom");
    const backTestroomBtn  = document.getElementById("back-testroom");
    const evolutionBtn     = document.getElementById("evolution");
    const backEvolutionBtn = document.getElementById("back-evolution");
    const backPushBtn      = document.getElementById("back-push");
    const pushStartBtn     = document.getElementById("push-start-btn");

    niveauBtn.addEventListener("click", () => setActiveScreen("niveau"));
    backNiveauBtn.addEventListener("click", () => setActiveScreen("main"));

    testroomBtn.addEventListener("click", () => {
      showTestroomMenu();
      setActiveScreen("testroom");
    });

    backTestroomBtn.addEventListener("click", () => setActiveScreen("niveau"));

    evolutionBtn.addEventListener("click", () => {
      setActiveScreen("evolution");
      updateRadarChart();
    });

    backEvolutionBtn.addEventListener("click", () => setActiveScreen("niveau"));

backPushBtn.addEventListener("click", () => {
  clearPushInterval();
  document.getElementById("push-overlay").classList.remove("active");
  exitFullscreenLandscape();
  setActiveScreen("testroom");
});


    pushStartBtn.addEventListener("click", () => {
      startPushInitialCountdown();
    });

    // Modules pas encore d√©velopp√©s
    document.getElementById("training").addEventListener("click", () => {
      alert("Module 'Training Camp' en construction üí•");
    });
    document.getElementById("improvise").addEventListener("click", () => {
      alert("Module 'S√©ance Improvis√©e' en construction üí•");
    });
    document.getElementById("historique").addEventListener("click", () => {
      alert("Module 'Historique des Perfs' en construction üí•");
    });

    /* ========= Stockage des tests ========= */
    const TEST_KEYS = [
      { key: "push",       label: "Puissance" },
      { key: "pull",       label: "Tirage" },
      { key: "legs",       label: "Jambes" },
      { key: "cardio",     label: "Cardio" },
      { key: "definition", label: "D√©finition" } // %BF (plus bas = mieux)
    ];
    const STORAGE_KEY = "physiqueRushTests";

    function loadTestData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch (e) {
        console.error("Erreur lecture stockage:", e);
        return {};
      }
    }

    function saveTestData(data) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.error("Erreur √©criture stockage:", e);
      }
    }

    // Transforme un %BF (plus bas = mieux) en "score" pour le radar
    function bfToScore(bf) {
      const maxBF = 30; // tr√®s gras
      const minBF = 8;  // tr√®s sec
      const clamped = Math.max(minBF, Math.min(maxBF, bf));
      const ratio01 = (maxBF - clamped) / (maxBF - minBF); // 30->0, 8->1
      return ratio01 * 10; // √©chelle 0..10
    }

    /* ========= La Test Room (formulaire manuel) ========= */
    const testroomMenu    = document.getElementById("testroom-menu");
    const testForm        = document.getElementById("test-form");
    const testNameEl      = document.getElementById("test-name");
    const testScoreInput  = document.getElementById("test-score");
    const saveTestBtn     = document.getElementById("save-test");
    const cancelTestBtn   = document.getElementById("cancel-test");
    let currentTestKey    = null;

    function showTestroomMenu() {
      testForm.style.display = "none";
      testroomMenu.style.display = "flex";
    }

    function showTestForm() {
      testroomMenu.style.display = "none";
      testForm.style.display = "flex";
    }

    // Ouverture de la saisie d'un test
    document.querySelectorAll(".test-btn").forEach(btn => {
      const key = btn.dataset.test;

      // Cas particulier : Puissance de Pouss√©e -> √©cran d√©di√©
      if (key === "push") {
        btn.addEventListener("click", () => {
          setActiveScreen("push");
        });
      } else {
        btn.addEventListener("click", () => {
          currentTestKey = key;

          const fullText = btn.textContent.trim();
          const firstLine = fullText.split("\n")[0];
          testNameEl.textContent = firstLine;

          if (currentTestKey === "definition") {
            testScoreInput.placeholder = "Entre ton %BF (ex : 12.5)";
          } else {
            testScoreInput.placeholder = "Entre ton score (reps, paliers, etc.)";
          }

          testScoreInput.value = "";
          showTestForm();
        });
      }
    });

    // Enregistrement d'un test
    saveTestBtn.addEventListener("click", () => {
      if (!currentTestKey) return;

      const rawVal = testScoreInput.value.replace(",", ".");
      const val = parseFloat(rawVal);

      if (isNaN(val) || val <= 0) {
        alert("Merci d'entrer une valeur num√©rique positive.");
        return;
      }

      const data = loadTestData();
      data[currentTestKey] = val;
      saveTestData(data);

      alert("Test sauvegard√© ‚úÖ");
      currentTestKey = null;
      showTestroomMenu();
    });

    // Annuler la saisie
    cancelTestBtn.addEventListener("click", () => {
      currentTestKey = null;
      showTestroomMenu();
    });

    /* ========= Radar 'Mon √âvolution' ========= */
    function updateRadarChart() {
      const canvas = document.getElementById("evolution-radar");
      const legendEl = document.getElementById("evo-legend");
      if (!canvas) return;

      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);

      const rawData = loadTestData();

      // Pr√©pare les valeurs pour les 5 axes
      const values = TEST_KEYS.map(t => {
        const v = rawData[t.key];
        if (!v || v <= 0) return 0;

        if (t.key === "definition") {
          return bfToScore(v);  // %BF -> score invers√©
        }
        return v;
      });

      const hasData = values.some(v => v > 0);

      if (!hasData) {
        legendEl.textContent =
          'Aucune donn√©e pour l\'instant. Va dans "La Test Room" pour enregistrer tes premiers tests.';
        return;
      } else {
        let txt = "Chaque axe repr√©sente ton dernier r√©sultat pour chaque test.";
        if (rawData.definition) {
          txt += " Axe D√©finition bas√© sur ton %BF actuel (" + rawData.definition + " %).";
        }
        legendEl.textContent = txt;
      }

      const cx = w / 2;
      const cy = h / 2;
      const radius = Math.min(w, h) * 0.35;

      // √âchelle max (min 10 pour garder une forme lisible)
      const maxValue = Math.max(10, ...values);

      ctx.save();
      ctx.translate(cx, cy);

      // Cercles de fond
      ctx.strokeStyle = "#552222";
      ctx.lineWidth = 1;
      const steps = 4;
      for (let s = 1; s <= steps; s++) {
        const r = (radius * s) / steps;
        ctx.beginPath();
        ctx.arc(0, 0, r, 0, Math.PI * 2);
        ctx.stroke();
      }

      // Axes + labels
      const n = TEST_KEYS.length;
      ctx.font = "12px Poppins, Arial";
      ctx.fillStyle = "#ffffff";

      TEST_KEYS.forEach((t, i) => {
        const angle = (Math.PI * 2 * i) / n - Math.PI / 2;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;

        // Axe
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(x, y);
        ctx.stroke();

        // Label un peu au-del√† du bord
        const lx = Math.cos(angle) * (radius + 16);
        const ly = Math.sin(angle) * (radius + 16);
        ctx.textAlign = lx > 0 ? "left" : "right";
        ctx.textBaseline = ly > 0 ? "top" : "bottom";
        ctx.fillText(t.label, lx, ly);
      });

      // Polygone des valeurs
      ctx.beginPath();
      values.forEach((val, i) => {
        const ratio = val / maxValue;
        const angle = (Math.PI * 2 * i) / n - Math.PI / 2;
        const r = radius * ratio;
        const x = Math.cos(angle) * r;
        const y = Math.sin(angle) * r;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.closePath();
      ctx.fillStyle = "rgba(255,80,80,0.35)";
      ctx.strokeStyle = "#ff5555";
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();

      ctx.restore();
    }


/* ========= Plein √©cran + verrouillage paysage ========= */
async function enterFullscreenLandscape() {
  const elem = document.documentElement;
  try {
    if (elem.requestFullscreen) {
      await elem.requestFullscreen();
    } else if (elem.webkitRequestFullscreen) {
      elem.webkitRequestFullscreen();
    }
    if (screen.orientation && screen.orientation.lock) {
      try {
        await screen.orientation.lock('landscape');
      } catch (e) {
        console.warn('Orientation lock non support√©e ou refus√©e.', e);
      }
    }
  } catch (e) {
    console.warn('Erreur plein √©cran :', e);
  }
}

async function exitFullscreenLandscape() {
  try {
    if (document.fullscreenElement || document.webkitFullscreenElement) {
      if (document.exitFullscreen) {
        await document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
    }
    if (screen.orientation && screen.orientation.unlock) {
      screen.orientation.unlock();
    }
  } catch (e) {
    console.warn('Erreur sortie plein √©cran :', e);
  }
}

    
    /* ========= Test Puissance de Pouss√©e (guid√©) ========= */
    const pushOverlay = document.getElementById("push-overlay");
    const pushOverlayContent = document.getElementById("push-overlay-content");
    let pushInterval = null;
    let pushTimeLeft = 0;
    let pushLevel1Validated = false;
    let audioCtx = null;

    function clearPushInterval() {
      if (pushInterval) {
        clearInterval(pushInterval);
        pushInterval = null;
      }
    }

    function playBeep() {
      try {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        if (!audioCtx) audioCtx = new AC();

        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc.type = "sine";
        osc.frequency.value = 1000;

        const now = audioCtx.currentTime;
        gain.gain.setValueAtTime(0.0001, now);
        gain.gain.exponentialRampToValueAtTime(0.2, now + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.25);

        osc.start(now);
        osc.stop(now + 0.3);
      } catch (e) {
        console.warn("Beep error", e);
      }
    }

function startPushInitialCountdown() {
  clearPushInterval();
  pushLevel1Validated = false;

  // Plein √©cran + paysage pendant le test
  enterFullscreenLandscape();

  pushOverlay.classList.add("active");
  pushOverlayContent.innerHTML =
    '<div class="big-countdown" id="push-big-count">5</div>';
  const countEl = document.getElementById("push-big-count");
  pushTimeLeft = 5;

  pushInterval = setInterval(() => {
    pushTimeLeft--;
    if (pushTimeLeft <= 0) {
      clearPushInterval();
      showPushLevel1Phase();
    } else {
      countEl.textContent = pushTimeLeft;
    }
  }, 1000);
}


    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return (m < 10 ? "0" : "") + m + ":" + (s < 10 ? "0" : "") + s;
    }

// variable globale pour garder une r√©f√©rence au player Vimeo
let pushVimeoPlayer = null;

function showPushLevel1Phase() {
  // 1) On construit l‚Äôinterface du palier
  pushOverlayContent.innerHTML = `
    <p class="push-phase-text" id="push-phase-text">
      Palier 1 : Vous avez 1 minute pour faire <b>10 pompes Dead Stop</b>
    </p>
    <div class="push-mini-video-wrapper">
      <iframe
        id="push-demo-video"
        src="https://player.vimeo.com/video/474104138?muted=1&playsinline=1"
        allow="autoplay; fullscreen; picture-in-picture"
        allowfullscreen
        title="D√©monstration pompes Dead Stop"
      ></iframe>
    </div>
    <div class="push-level-count" id="push-level-count">01:00</div>
    <div class="push-actions">
      <button class="push-ok-btn" id="push-ok-btn">‚úÖ Valid√©</button>
      <button class="push-fail-btn" id="push-fail-btn">‚ùå Non valid√©</button>
    </div>
  `;

  const okBtn   = document.getElementById("push-ok-btn");
  const failBtn = document.getElementById("push-fail-btn");
  const textEl  = document.getElementById("push-phase-text");

  // 2) On initialise le player Vimeo SUR l‚Äôiframe qu‚Äôon vient de cr√©er
  const iframe = document.getElementById("push-demo-video");
  pushVimeoPlayer = new Vimeo.Player(iframe);

  // Boucle & muet (sinon l‚Äôautoplay est souvent bloqu√©)
  pushVimeoPlayer.setLoop(true);
  pushVimeoPlayer.setMuted(true);

  // 3) Quand la vid√©o est pr√™te, on lance LA LECTURE + LE CHRONO dans la m√™me fonction
  pushVimeoPlayer.ready().then(() => {
    // on s‚Äôassure de repartir du d√©but √† chaque palier
    pushVimeoPlayer.setCurrentTime(0).then(() => {
      pushVimeoPlayer.play();          // d√©marrage vid√©o
      startPushOneMinuteCountdown();   // d√©marrage chrono synchronis√©
    });
  });

  // 4) Gestion des boutons ‚úÖ / ‚ùå (et on les d√©sactive apr√®s clic)
  okBtn.addEventListener("click", () => {
    if (okBtn.disabled || failBtn.disabled) return; // d√©j√† cliqu√©
    okBtn.disabled = true;
    failBtn.disabled = true;

    textEl.innerHTML =
      "‚úÖ <b>Reposez-vous !</b><br>Le palier suivant arrive dans quelques instants...";

    // on laisse le chrono finir + la vid√©o tourner (on programmera la suite plus tard)
  });

  failBtn.addEventListener("click", () => {
    if (okBtn.disabled || failBtn.disabled) return;
    okBtn.disabled = true;
    failBtn.disabled = true;

    // on stoppe la vid√©o si tu veux que tout se fige
    if (pushVimeoPlayer) {
      pushVimeoPlayer.pause();
    }

    textEl.innerHTML =
      "‚ùå <b>Test termin√©.</b><br>Votre Puissance de pouss√©e est de <b>NIVEAU 1</b>.";

    // ici tu pourras plus tard enregistrer le niveau dans le profil
  });
}

let pushOneMinuteTimerId = null;

function startPushOneMinuteCountdown() {
  const countEl = document.getElementById("push-level-count");
  if (!countEl) return;

  let remaining = 60; // secondes

  // pour afficher 01:00 au d√©marrage
  countEl.textContent = "01:00";

  if (pushOneMinuteTimerId) {
    clearInterval(pushOneMinuteTimerId);
  }

  pushOneMinuteTimerId = setInterval(() => {
    remaining--;

    if (remaining < 0) {
      clearInterval(pushOneMinuteTimerId);
      pushOneMinuteTimerId = null;

      // ici, fin du palier : 3 bips par exemple, plus tard
      return;
    }

    const mm = String(Math.floor(remaining / 60)).padStart(2, "0");
    const ss = String(remaining % 60).padStart(2, "0");
    countEl.textContent = `${mm}:${ss}`;
  }, 1000);
}


    // PWA
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(() => console.log("Service Worker enregistr√©"))
        .catch(err => console.error("Erreur SW :", err));
    }
  </script>
</body>
</html>
