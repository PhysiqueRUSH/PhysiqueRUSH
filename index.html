<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysiqueRUSH</title>
  <link rel="icon" type="image/png" href="icon-192.png" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0d0d0d" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Poppins", Arial, sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at center, #1a0000, #000);
      color: white;
      overflow: hidden;
    }

    .screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      padding-top: 5vh;
    }

    .screen.active {
      opacity: 1;
      pointer-events: auto;
    }
    

    /* --- Logo & titre --- */
    .logo {
      width: 120px;
      height: 120px;
      border-radius: 20%;
      box-shadow: 0 0 25px #ff000044, 0 0 60px #ff000022 inset;
      animation: logoPulse 3s infinite alternate;
      margin-bottom: 1rem;
      z-index: 2;
    }

    @keyframes logoPulse {
      from { box-shadow: 0 0 25px #ff000033, 0 0 70px #ff000011 inset; }
      to   { box-shadow: 0 0 45px #ff000077, 0 0 120px #ff000033 inset; }
    }

    h1 {
      font-size: 2.8rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #ff2b2b;
      text-shadow: 0 0 30px #ff000099;
      margin-bottom: 2rem;
      animation: glowPulse 3s infinite alternate;
      z-index: 2;
    }

    @keyframes glowPulse {
      from { text-shadow: 0 0 10px #ff1a1a; }
      to   { text-shadow: 0 0 45px #ff0000; }
    }

    /* --- Menus g√©n√©raux --- */
    .menu {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 1.4rem;
      margin-top: 1rem;
      z-index: 2;
      width: 80%;
      max-width: 400px;
    }

    button {
      background: linear-gradient(145deg, #330000, #660000);
      border: 2px solid #ff2b2b;
      color: #fff;
      font-size: 1.15rem;
      font-weight: bold;
      padding: 1.1rem 0;
      width: 100%;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 0 20px #ff000044;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      z-index: 2;
    }

    button:hover {
      background: linear-gradient(145deg, #660000, #990000);
      box-shadow: 0 0 30px #ff000088;
      transform: scale(1.03);
    }

    /* Effet rouge doux autour des boutons (SANS animation pour les perfs) */
    button::before {
      content: "";
      position: absolute;
      top: -40%;
      left: -40%;
      width: 180%;
      height: 180%;
      background: radial-gradient(circle, rgba(255,0,0,0.18) 0%, transparent 70%);
      filter: blur(45px);
      z-index: -1;
      opacity: 0.7;
    }

    /* --- Fond gazeux global (halo rouge statique, pas d'animation) --- */
    .background-glow, .background-glow2 {
      position: absolute;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, #ff000033 0%, transparent 70%);
      filter: blur(100px);
      z-index: 0;
    }

    .background-glow {
      top: -100px;
      left: -100px;
    }

    .background-glow2 {
      bottom: -150px;
      right: -150px;
      width: 800px;
      height: 800px;
      background: radial-gradient(circle, #ff222244 0%, transparent 70%);
    }

    /* --- Footer --- */
    footer {
      position: absolute;
      bottom: 12px;
      font-size: 0.8rem;
      color: #666;
      z-index: 2;
    }

    footer span {
      color: #ff3333;
      font-weight: bold;
    }

    /* --- Bouton retour (bas gauche, compact) --- */
    .back-btn {
      position: absolute;
      bottom: 60px; /* bien s√©par√© du footer */
      left: 25px;
      background: #660000aa;
      color: #fff;
      border: 1px solid #ff3333;
      border-radius: 10px;
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 0 10px #ff000055;
      transition: all 0.2s ease;
      width: auto;
      z-index: 5;
    }

    .back-btn:hover {
      background: #990000;
      transform: scale(1.05);
    }

    /* --- Textes secondaires --- */
    .subtitle {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #dddddd;
      text-align: center;
      max-width: 85%;
      z-index: 2;
    }

    .small-text {
      margin-top: 0.4rem;
      font-size: 0.8rem;
      color: #bbbbbb;
      text-align: center;
      max-width: 90%;
      z-index: 2;
    }

    /* --- La Test Room --- */
    .testroom-container {
      margin-top: 0.5rem;
      width: 90%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      z-index: 2;
    }

    .testroom-container .menu {
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .test-btn {
      font-size: 1rem;
      padding: 0.9rem 0;
      text-transform: none;
      letter-spacing: 0.5px;
    }

    .test-btn span {
      font-size: 0.8rem;
      font-weight: normal;
      text-transform: none;
    }

    .test-form {
      width: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      margin-top: 1rem;
    }

    .test-input {
      width: 100%;
      padding: 0.8rem;
      border-radius: 12px;
      border: 1px solid #ff5555;
      background: #1a0000;
      color: #ffffff;
      font-size: 1rem;
      text-align: center;
      outline: none;
    }

    .test-buttons-row {
      display: flex;
      gap: 0.8rem;
      width: 100%;
    }

    .test-buttons-row button {
      flex: 1;
      font-size: 1rem;
      padding: 0.8rem 0;
    }

    /* --- Mon √âvolution / Radar --- */
    .evolution-container {
      margin-top: 0.5rem;
      width: 90%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      z-index: 2;
    }

    #evolution-radar {
      background: radial-gradient(circle at center, #220000, #000000);
      border-radius: 50%;
      box-shadow: 0 0 20px #ff000040;
    }
  </style>
</head>

<body>
  <!-- Fond gazeux -->
  <div class="background-glow"></div>
  <div class="background-glow2"></div>

  <!-- √âcran principal -->
  <section id="main-screen" class="screen active">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="menu">
      <button id="niveau">üí™ Mon Niveau</button>
      <button id="training">üî• Training Camp</button>
      <button id="improvise">‚ö° S√©ance Improvis√©e</button>
    </div>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "Mon Niveau" -->
  <section id="niveau-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="menu">
      <button id="testroom">üî± La Test Room</button>
      <button id="evolution">üß¨ Mon √âvolution</button>
      <button id="historique">üèÜ Historique des Perfs</button>
    </div>

    <button class="back-btn" id="back-niveau">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "La Test Room" -->
  <section id="testroom-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="testroom-container">
      <p class="subtitle">
        Choisis un test, entre ton score et valide. Seul le <b>dernier r√©sultat</b> est utilis√© pour le radar.
      </p>

      <!-- Menu des tests -->
      <div class="menu" id="testroom-menu">
        <button class="test-btn" data-test="push">
          üí• Palier Push<br><span>Puissance de pouss√©e</span>
        </button>
        <button class="test-btn" data-test="pull">
          üõ° Palier Pull<br><span>Endurance du dos</span>
        </button>
        <button class="test-btn" data-test="legs">
          ü¶µ Palier Legs<br><span>Force des jambes</span>
        </button>
        <button class="test-btn" data-test="cardio">
          ‚ù§Ô∏è Test Cardio<br><span>Capacit√© cardiaque</span>
        </button>
        <button class="test-btn" data-test="definition">
          üß± D√©finition<br><span>%BF (plus bas = mieux)</span>
        </button>
      </div>

      <!-- Formulaire de saisie d'un test -->
      <div id="test-form" class="test-form">
        <h2 id="test-name">Test</h2>
        <input
          type="number"
          id="test-score"
          class="test-input"
          step="0.1"
          placeholder="Entre ton score"
        />
        <div class="test-buttons-row">
          <button id="save-test">‚úÖ Enregistrer</button>
          <button id="cancel-test">‚úñ Annuler</button>
        </div>
        <p class="small-text">
          Pour la <b>D√©finition</b>, saisis simplement ton <b>%BF actuel</b> (plus il est bas, mieux c'est).
        </p>
      </div>
    </div>

    <button class="back-btn" id="back-testroom">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <!-- √âcran "Mon √âvolution" -->
  <section id="evolution-screen" class="screen">
    <img src="icon-512.png" alt="Logo PhysiqueRUSH" class="logo" />
    <h1>PhysiqueRUSH</h1>

    <div class="evolution-container">
      <p class="subtitle">
        Radar des 5 tests : Push, Pull, Legs, Cardio, D√©finition (%BF). Chaque axe utilise ton <b>dernier</b> r√©sultat.
      </p>

      <canvas id="evolution-radar" width="320" height="320"></canvas>

      <p id="evo-legend" class="small-text">
        Va dans "La Test Room" pour enregistrer tes premiers tests.
      </p>
    </div>

    <button class="back-btn" id="back-evolution">‚¨Ö Retour</button>

    <footer>powered by <span>PhysiqueRUSH</span> ‚Äì Massive Impact</footer>
  </section>

  <script>
    /* ========= Navigation entre √©crans ========= */
    const screens = {
      main:      document.getElementById("main-screen"),
      niveau:    document.getElementById("niveau-screen"),
      testroom:  document.getElementById("testroom-screen"),
      evolution: document.getElementById("evolution-screen"),
    };

    function setActiveScreen(name) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      if (screens[name]) {
        screens[name].classList.add("active");
      }
    }

    // Boutons principaux
    const niveauBtn        = document.getElementById("niveau");
    const backNiveauBtn    = document.getElementById("back-niveau");
    const testroomBtn      = document.getElementById("testroom");
    const backTestroomBtn  = document.getElementById("back-testroom");
    const evolutionBtn     = document.getElementById("evolution");
    const backEvolutionBtn = document.getElementById("back-evolution");

    niveauBtn.addEventListener("click", () => setActiveScreen("niveau"));
    backNiveauBtn.addEventListener("click", () => setActiveScreen("main"));

    testroomBtn.addEventListener("click", () => {
      showTestroomMenu();
      setActiveScreen("testroom");
    });

    backTestroomBtn.addEventListener("click", () => setActiveScreen("niveau"));

    evolutionBtn.addEventListener("click", () => {
      setActiveScreen("evolution");
      updateRadarChart();
    });

    backEvolutionBtn.addEventListener("click", () => setActiveScreen("niveau"));

    // Modules pas encore d√©velopp√©s
    document.getElementById("training").addEventListener("click", () => {
      alert("Module 'Training Camp' en construction üí•");
    });
    document.getElementById("improvise").addEventListener("click", () => {
      alert("Module 'S√©ance Improvis√©e' en construction üí•");
    });
    document.getElementById("historique").addEventListener("click", () => {
      alert("Module 'Historique des Perfs' en construction üí•");
    });

    /* ========= Stockage des tests ========= */
    const TEST_KEYS = [
      { key: "push",       label: "Push" },
      { key: "pull",       label: "Pull" },
      { key: "legs",       label: "Legs" },
      { key: "cardio",     label: "Cardio" },
      { key: "definition", label: "D√©finition" } // %BF (plus bas = mieux)
    ];
    const STORAGE_KEY = "physiqueRushTests";

    function loadTestData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch (e) {
        console.error("Erreur lecture stockage:", e);
        return {};
      }
    }

    function saveTestData(data) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.error("Erreur √©criture stockage:", e);
      }
    }

    // Transforme un %BF (plus bas = mieux) en "score" pour le radar
    // ‚â• 30 %  -> score mini
    // 8  %    -> score maxi
    function bfToScore(bf) {
      const maxBF = 30; // tr√®s gras
      const minBF = 8;  // tr√®s sec
      const clamped = Math.max(minBF, Math.min(maxBF, bf));
      const ratio01 = (maxBF - clamped) / (maxBF - minBF); // 30->0, 8->1
      return ratio01 * 10; // on ram√®ne sur une √©chelle 0..10
    }

    /* ========= La Test Room ========= */
    const testroomMenu    = document.getElementById("testroom-menu");
    const testForm        = document.getElementById("test-form");
    const testNameEl      = document.getElementById("test-name");
    const testScoreInput  = document.getElementById("test-score");
    const saveTestBtn     = document.getElementById("save-test");
    const cancelTestBtn   = document.getElementById("cancel-test");
    let currentTestKey    = null;

    function showTestroomMenu() {
      testForm.style.display = "none";
      testroomMenu.style.display = "flex";
    }

    function showTestForm() {
      testroomMenu.style.display = "none";
      testForm.style.display = "flex";
    }

    // Ouverture de la saisie d'un test
    document.querySelectorAll(".test-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        currentTestKey = btn.dataset.test;

        // Titre = premi√®re ligne du bouton
        const fullText = btn.textContent.trim();
        const firstLine = fullText.split("\n")[0];
        testNameEl.textContent = firstLine;

        // Placeholder sp√©cifique pour D√©finition (%BF)
        if (currentTestKey === "definition") {
          testScoreInput.placeholder = "Entre ton %BF (ex : 12.5)";
        } else {
          testScoreInput.placeholder = "Entre ton score (reps, paliers, etc.)";
        }

        testScoreInput.value = "";
        showTestForm();
      });
    });

    // Enregistrement d'un test
    saveTestBtn.addEventListener("click", () => {
      if (!currentTestKey) return;

      const rawVal = testScoreInput.value.replace(",", ".");
      const val = parseFloat(rawVal);

      if (isNaN(val) || val <= 0) {
        alert("Merci d'entrer une valeur num√©rique positive.");
        return;
      }

      const data = loadTestData();
      data[currentTestKey] = val;
      saveTestData(data);

      alert("Test sauvegard√© ‚úÖ");
      currentTestKey = null;
      showTestroomMenu();
    });

    // Annuler la saisie
    cancelTestBtn.addEventListener("click", () => {
      currentTestKey = null;
      showTestroomMenu();
    });

    /* ========= Radar 'Mon √âvolution' ========= */
    function updateRadarChart() {
      const canvas = document.getElementById("evolution-radar");
      const legendEl = document.getElementById("evo-legend");
      if (!canvas) return;

      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);

      const rawData = loadTestData();

      // Pr√©pare les valeurs pour les 5 axes
      const values = TEST_KEYS.map(t => {
        const v = rawData[t.key];
        if (!v || v <= 0) return 0;

        if (t.key === "definition") {
          // v = %BF ‚Üí transform√© en score "d√©finition"
          return bfToScore(v);
        }
        return v;
      });

      const hasData = values.some(v => v > 0);

      if (!hasData) {
        legendEl.textContent =
          'Aucune donn√©e pour l\'instant. Va dans "La Test Room" pour enregistrer tes premiers tests.';
        return;
      } else {
        let txt = "Chaque axe repr√©sente ton dernier r√©sultat pour chaque test.";
        if (rawData.definition) {
          txt += " Axe D√©finition bas√© sur ton %BF actuel (" + rawData.definition + " %).";
        }
        legendEl.textContent = txt;
      }

      const cx = w / 2;
      const cy = h / 2;
      const radius = Math.min(w, h) * 0.35;

      // √âchelle max (min 10 pour garder une forme lisible)
      const maxValue = Math.max(10, ...values);

      ctx.save();
      ctx.translate(cx, cy);

      // Cercles de fond
      ctx.strokeStyle = "#552222";
      ctx.lineWidth = 1;
      const steps = 4;
      for (let s = 1; s <= steps; s++) {
        const r = (radius * s) / steps;
        ctx.beginPath();
        ctx.arc(0, 0, r, 0, Math.PI * 2);
        ctx.stroke();
      }

      // Axes + labels
      const n = TEST_KEYS.length;
      ctx.font = "12px Poppins, Arial";
      ctx.fillStyle = "#ffffff";

      TEST_KEYS.forEach((t, i) => {
        const angle = (Math.PI * 2 * i) / n - Math.PI / 2;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;

        // Axe
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(x, y);
        ctx.stroke();

        // Label un peu au-del√† du bord
        const lx = Math.cos(angle) * (radius + 16);
        const ly = Math.sin(angle) * (radius + 16);
        ctx.textAlign = lx > 0 ? "left" : "right";
        ctx.textBaseline = ly > 0 ? "top" : "bottom";
        ctx.fillText(t.label, lx, ly);
      });

      // Polygone des valeurs
      ctx.beginPath();
      values.forEach((val, i) => {
        const ratio = val / maxValue;
        const angle = (Math.PI * 2 * i) / n - Math.PI / 2;
        const r = radius * ratio;
        const x = Math.cos(angle) * r;
        const y = Math.sin(angle) * r;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.closePath();
      ctx.fillStyle = "rgba(255,80,80,0.35)";
      ctx.strokeStyle = "#ff5555";
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();

      ctx.restore();
    }

    // PWA
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(() => console.log("Service Worker enregistr√©"))
        .catch(err => console.error("Erreur SW :", err));
    }
  </script>
</body>
</html>
